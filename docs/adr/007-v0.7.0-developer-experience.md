# ADR 007 - v0.7.0 Developer Experience Features

**Status**: Proposed

**Date**: 2025-01-17

**Authors**: Felix Geelhaar

## Context

cclint v0.6.0 achieved 10/10 Anthropic alignment with comprehensive validation rules. However, the tool's usability in daily development workflows has room for improvement:

1. **No watch mode**: Developers must manually re-run linting after each change
2. **No scaffolding**: New projects require manually writing CLAUDE.md from scratch
3. **No Git integration**: Pre-commit hooks require manual setup
4. **No interactive fixing**: Auto-fix is all-or-nothing, no review process
5. **No rule documentation CLI**: Must read docs online to understand rules
6. **No diff-aware linting**: CI runs full lint even for small changes

These friction points slow adoption and make the tool less pleasant to use compared to established linters like ESLint, which provide all these features.

## Decision

Implement six developer experience features in v0.7.0:

### 1. Watch Mode (`cclint watch`)

Use `chokidar` for cross-platform file watching with debouncing:

```typescript
interface WatchOptions {
  recursive?: boolean; // Watch subdirectories
  fix?: boolean; // Auto-fix on change
  debounce?: number; // Debounce ms (default 300)
  clear?: boolean; // Clear terminal between runs
}
```

**Why chokidar**: Battle-tested, cross-platform, handles edge cases (atomic saves, editor temp files).

### 2. Init Command (`cclint init`)

Template-based scaffolding with project detection:

```typescript
interface InitOptions {
  template?: string; // Template name
  detect?: boolean; // Auto-detect project type
  interactive?: boolean; // Prompt for options
  force?: boolean; // Overwrite existing
}

const TEMPLATES = [
  'minimal',
  'typescript',
  'python',
  'go',
  'monorepo',
  'library',
  'api',
];
```

**Detection heuristics**:

- `package.json` → TypeScript/JavaScript
- `pyproject.toml` / `setup.py` → Python
- `go.mod` → Go
- `Cargo.toml` → Rust
- Multiple `package.json` files → Monorepo

### 3. Pre-commit Hook (`cclint install-hook`)

Support multiple hook managers with auto-detection:

```typescript
type HookManager = 'husky' | 'lefthook' | 'pre-commit' | 'git';

interface InstallHookOptions {
  manager?: HookManager; // Auto-detect if not specified
  fix?: boolean; // Run with --fix
  staged?: boolean; // Only check staged files
}
```

**Priority order**: husky > lefthook > pre-commit > raw git hooks.

### 4. Interactive Fix Mode (`--interactive`)

Step-through interface for reviewing fixes:

```typescript
interface InteractiveSession {
  violations: Violation[];
  current: number;
  actions: ('apply' | 'skip' | 'apply-all' | 'quit')[];
}
```

**UI**: Use `inquirer` or `prompts` for terminal interaction.

### 5. Explain Command (`cclint explain`)

Rule documentation from CLI:

```typescript
interface ExplainOptions {
  rule?: string; // Specific rule ID
  all?: boolean; // List all rules
  category?: string; // Filter by category
  json?: boolean; // JSON output
}
```

**Data source**: Embed rule metadata in rule classes, extract at build time.

### 6. Diff-Aware Linting (`--diff`)

Only report violations in changed lines:

```typescript
interface DiffOptions {
  ref: string; // Git ref to compare against
  showAll?: boolean; // Show all violations, mark new ones
}
```

**Implementation**: Use `simple-git` to get diff, filter violations by changed line ranges.

## Alternatives Considered

### Watch Mode

**Alternative**: Use nodemon/ts-node-dev wrapper

- **Rejected**: External dependency, less control over output formatting

**Alternative**: Native fs.watch

- **Rejected**: Platform inconsistencies, no debouncing

### Init Command

**Alternative**: Yeoman generator

- **Rejected**: Heavy dependency for simple templating

**Alternative**: Copy from online templates

- **Rejected**: Requires network, harder to customize

### Pre-commit Hooks

**Alternative**: Only support Husky

- **Rejected**: Limits adoption for teams using other tools

**Alternative**: Use lint-staged directly

- **Rejected**: Another dependency, cclint can handle staging itself

### Interactive Mode

**Alternative**: TUI with blessed/ink

- **Rejected**: Overkill for simple yes/no decisions

**Alternative**: Web interface for fixes

- **Rejected**: Scope creep, save for v1.0 playground

## Consequences

### Positive Consequences

- **Faster feedback loop**: Watch mode enables TDD-style CLAUDE.md editing
- **Lower barrier to entry**: init command helps new users start correctly
- **Git workflow integration**: Pre-commit hooks catch issues before commit
- **Safer fixing**: Interactive mode allows reviewing changes before applying
- **Self-documenting**: explain command reduces need to visit documentation
- **Faster CI**: diff-aware linting reduces CI time for large files

### Negative Consequences

- **More dependencies**: chokidar, inquirer, simple-git add to bundle size
- **More code to maintain**: Six new command implementations
- **Platform testing needed**: Watch mode and hooks have platform-specific behavior

### Neutral Consequences

- CLI API surface area increases but follows established patterns
- May need to refactor command structure for better organization

## Implementation Plan

1. **Watch Mode** (3-5 days)
   - Add chokidar dependency
   - Implement watch command
   - Add clear/debounce options
   - Write tests with mock file system

2. **Init Command** (3-5 days)
   - Create template system
   - Implement project detection
   - Build interactive prompts
   - Write tests for each template

3. **Pre-commit Hook** (2-3 days)
   - Implement hook manager detection
   - Write hook installation logic
   - Add uninstall command
   - Test with each hook manager

4. **Interactive Mode** (2-3 days)
   - Add inquirer dependency
   - Build interactive session handler
   - Implement fix preview rendering
   - Write integration tests

5. **Explain Command** (1-2 days)
   - Add metadata to rule classes
   - Implement explain command
   - Add category filtering
   - Write tests

6. **Diff-Aware Linting** (2-3 days)
   - Add simple-git dependency
   - Implement diff parsing
   - Filter violations by line ranges
   - Write tests with mock git repos

**Total estimate**: 13-21 days of development

## Follow-up Actions

- [ ] Create GitHub issues for each feature
- [ ] Set up feature branch structure
- [ ] Update CI to test new commands
- [ ] Write user documentation
- [ ] Create migration guide from v0.6.0

## References

- [Roadmap v0.7.0](../ROADMAP.md#v070---developer-experience)
- [ESLint Watch Mode](https://eslint.org/docs/latest/use/command-line-interface#--watch)
- [Chokidar Documentation](https://github.com/paulmillr/chokidar)
- [Inquirer.js](https://github.com/SBoudrias/Inquirer.js)
- Related ADRs: [003-hexagonal-architecture](./003-hexagonal-architecture.md)
